<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MTG Mobile Lite</title>
    <style>
        :root { --bg: #121212; --card-bg: #2a2a2e; --text: #e0e0e0; --accent: #3a7bd5; }
        * { box-sizing: border-box; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Phase Tracker */
        #phase-bar { background: #000; display: flex; justify-content: space-around; padding: 8px; font-size: 10px; font-weight: bold; border-bottom: 2px solid var(--accent); }
        .phase-item { opacity: 0.3; }
        .phase-item.active { opacity: 1; color: var(--accent); }

        /* Zones */
        #game-container { flex: 1; display: flex; flex-direction: column; justify-content: space-between; padding: 5px; overflow: hidden; }
        .zone { display: flex; gap: 8px; overflow-x: auto; padding: 5px 0; min-height: 100px; border-bottom: 1px solid #333; align-items: center; }
        .zone-label { font-size: 10px; color: #666; position: absolute; }

        /* Card Styling */
        .card { 
            width: 75px; height: 105px; background: var(--card-bg); border: 1px solid #555; border-radius: 5px; 
            flex-shrink: 0; display: flex; flex-direction: column; padding: 4px; position: relative; font-size: 9px; 
        }
        .card.tapped { transform: rotate(10deg); filter: brightness(0.5); border-color: #f00; }
        .card-header { display: flex; justify-content: space-between; font-weight: bold; border-bottom: 1px solid #444; margin-bottom: 2px; }
        .card-cost { color: #aaa; }
        .card-desc { font-style: italic; color: #999; flex: 1; line-height: 1.1; margin-top: 2px; }
        .card-stats { text-align: right; font-weight: bold; font-size: 11px; }
        .land-card { background: #2d382d; }
        
        /* UI Elements */
        .stats-row { display: flex; justify-content: space-between; padding: 5px; font-size: 13px; background: #1a1a1a; }
        #log { font-size: 11px; height: 50px; overflow-y: auto; background: #000; color: #4af; padding: 5px; border-top: 1px solid #333; }
        .controls { padding: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: #1a1a1a; }
        button { padding: 12px; border-radius: 8px; border: none; font-weight: bold; font-size: 14px; background: var(--accent); color: white; }
        button:disabled { background: #444; color: #888; }
        #btn-next { background: #28a745; }
    </style>
</head>
<body>

<div id="phase-bar">
    <span id="p-UNTAP" class="phase-item">UNTAP</span>
    <span id="p-DRAW" class="phase-item">DRAW</span>
    <span id="p-MAIN1" class="phase-item">MAIN 1</span>
    <span id="p-COMBAT" class="phase-item">COMBAT</span>
    <span id="p-MAIN2" class="phase-item">MAIN 2</span>
</div>

<div id="game-container">
    <div class="stats-row" id="ai-stats">AI: 20 HP</div>
    <div class="zone" id="ai-field"></div>
    
    <div id="log">Game Started. Your Turn.</div>
    
    <div class="zone" id="player-field"></div>
    <div class="stats-row" id="player-stats">YOU: 20 HP | Mana: 0</div>
    <div class="zone" id="player-hand"></div>
</div>

<div class="controls">
    <button id="btn-land" onclick="playLandAction()">Play Land</button>
    <button id="btn-next" onclick="nextPhase()">Next Phase</button>
</div>

<script>
const PHASES = ['MAIN1', 'COMBAT', 'MAIN2'];
let state = {
    p_hp: 20, p_hand: [], p_field: [], p_mana: 0, p_landPlayed: false,
    ai_hp: 20, ai_hand: [], ai_field: [], ai_mana: 0,
    phaseIdx: 0,
    turn: 1,
    isAITurn: false
};

const DECK_RECIPES = [
    { name: "Forest", type: "land", cost: 0, desc: "Tap for 1 Mana" },
    { name: "Elf", type: "creature", cost: 1, p: 1, t: 1, desc: "Swift & small." },
    { name: "Warrior", type: "creature", cost: 2, p: 2, t: 2, desc: "Battle-hardened." },
    { name: "Beast", type: "creature", cost: 4, p: 4, t: 4, desc: "A massive brute." }
];

function createCard(recipe) {
    return { ...recipe, id: Math.random(), tapped: false, sickness: true };
}

function initGame() {
    for(let i=0; i<7; i++) {
        state.p_hand.push(createCard(DECK_RECIPES[Math.floor(Math.random() * 2)]));
        state.ai_hand.push(createCard(DECK_RECIPES[Math.floor(Math.random() * 2)]));
    }
    updateUI();
}

function updateUI() {
    // Update Stats
    document.getElementById('player-stats').innerHTML = `YOU: <b>${state.p_hp}</b> | Available Mana: <b>${state.p_mana}</b>`;
    document.getElementById('ai-stats').innerHTML = `AI: <b>${state.ai_hp}</b> | Cards: ${state.ai_hand.length}`;
    
    // Update Phases
    document.querySelectorAll('.phase-item').forEach(el => el.classList.remove('active'));
    if (!state.isAITurn) document.getElementById('p-' + PHASES[state.phaseIdx]).classList.add('active');

    renderZone('player-hand', state.p_hand, true);
    renderZone('player-field', state.p_field, false, true);
    renderZone('ai-field', state.ai_field);
    
    document.getElementById('btn-land').disabled = state.p_landPlayed || state.isAITurn;
    document.getElementById('btn-next').innerText = (state.phaseIdx === 2) ? "End Turn" : "Next Phase";
}

function renderZone(id, cards, isHand = false, isPlayerField = false) {
    const el = document.getElementById(id);
    el.innerHTML = '';
    cards.forEach(card => {
        const div = document.createElement('div');
        div.className = `card ${card.type === 'land' ? 'land-card' : ''} ${card.tapped ? 'tapped' : ''}`;
        div.innerHTML = `
            <div class="card-header"><span>${card.name}</span><span class="card-cost">${card.type === 'creature' ? card.cost : ''}</span></div>
            <div class="card-desc">${card.desc}</div>
            ${card.type === 'creature' ? `<div class="card-stats">${card.p}/${card.t}</div>` : ''}
        `;
        if (isHand && !state.isAITurn) div.onclick = () => playCard(card);
        if (isPlayerField && card.type === 'land') div.onclick = () => tapLand(card);
        el.appendChild(div);
    });
}

function log(msg) {
    const l = document.getElementById('log');
    l.innerHTML = `> ${msg}<br>${l.innerHTML}`;
}

function tapLand(card) {
    if (card.tapped) return;
    card.tapped = true;
    state.p_mana++;
    log("Tapped Forest for 1 Mana.");
    updateUI();
}

function playCard(card) {
    if (card.type === 'land' && !state.p_landPlayed) {
        state.p_field.push(card);
        state.p_hand = state.p_hand.filter(c => c.id !== card.id);
        state.p_landPlayed = true;
        log("Played Land.");
    } else if (card.type === 'creature' && state.p_mana >= card.cost) {
        state.p_mana -= card.cost;
        state.p_field.push(card);
        state.p_hand = state.p_hand.filter(c => c.id !== card.id);
        log(`Cast ${card.name}.`);
    }
    updateUI();
}

function nextPhase() {
    if (state.isAITurn) return;
    
    if (state.phaseIdx === 0) { // Main 1 -> Combat
        state.phaseIdx = 1;
        let dmg = 0;
        state.p_field.forEach(c => {
            if (c.type === 'creature' && !c.sickness && !c.tapped) {
                c.tapped = true;
                dmg += c.p;
            }
        });
        state.ai_hp -= dmg;
        log(`Combat: You dealt ${dmg} damage!`);
    } else if (state.phaseIdx === 1) { // Combat -> Main 2
        state.phaseIdx = 2;
    } else { // Main 2 -> AI Turn
        startAITurn();
        return;
    }
    updateUI();
}

async function startAITurn() {
    state.isAITurn = true;
    state.phaseIdx = 0;
    updateUI();
    
    log("AI Turn Starting...");
    await new Promise(r => setTimeout(r, 800));
    
    // AI Draw
    state.ai_hand.push(createCard(DECK_RECIPES[Math.floor(Math.random() * DECK_RECIPES.length)]));
    state.ai_field.forEach(c => { c.tapped = false; c.sickness = false; });
    
    // AI Play Land
    let lIdx = state.ai_hand.findIndex(c => c.type === 'land');
    if(lIdx > -1) state.ai_field.push(state.ai_hand.splice(lIdx, 1)[0]);
    
    // AI Play Creature
    let m = state.ai_field.filter(c => c.type === 'land').length;
    let cIdx = state.ai_hand.findIndex(c => c.type === 'creature' && c.cost <= m);
    if(cIdx > -1) state.ai_field.push(state.ai_hand.splice(cIdx, 1)[0]);

    // AI Attack
    let admg = 0;
    state.ai_field.forEach(c => { if(c.type === 'creature' && !c.sickness) { admg += c.p; c.tapped = true; }});
    state.p_hp -= admg;
    log(`AI attacked for ${admg} damage!`);

    await new Promise(r => setTimeout(r, 800));
    
    // Reset for Player Turn
    state.isAITurn = false;
    state.p_landPlayed = false;
    state.p_mana = 0;
    state.p_field.forEach(c => { c.tapped = false; c.sickness = false; });
    state.p_hand.push(createCard(DECK_RECIPES[Math.floor(Math.random() * DECK_RECIPES.length)]));
    log("Your Turn: Card Drawn & Untapped.");
    updateUI();
}

initGame();
</script>
</body>
</html>
